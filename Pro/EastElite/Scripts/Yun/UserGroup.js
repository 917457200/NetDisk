function Query(a) { var b = ["GroupName", "CreateUserName", "CreateTime", "GroupNote", "操作"]; var e = "/UserGroup/GetGroupList"; var f = $("#GroupName").val().trim(); var d = $("#UserName").val().trim(); var c = ""; if (f != null && f != "") { c = f } if (d != null && d != "") { c += "★" + d } GetData(e, b, a, c) } function SetOperate(b) { var c = '<td align="center">'; var a = $("#userCode").val(); if (b.CreateUserId == a) { c += '<a  href="/UserGroup/UserGroupAdd?id=' + b.GroupId + '" ><span class=\'btn btn-primary\' style="color:#fff;">修改</span><a>'; c += "<span class='btn btn-primary' style=\"color:#fff;\" onclick=\"Laryer('删除','DelGroup','" + b.GroupId + "')\">删除</span>" } else { if (b.Examine == null) { c += "<span class='btn btn-primary' style=\"color:#fff;\" onclick=\"Laryer('申请加入','Apply','" + b.GroupId + "','" + a + "')\">申请加入</span>" } else { if (b.Examine == false) { c += "<span >您已申请</span>" } else { if (b.Examine == true) { c += "<span >您已在组中 <span class='btn btn-primary' style=\"color:#fff;\" onclick=\"Laryer('退出','Quit','" + b.GroupId + "','" + a + "')\">退出</span></span>" } } } } c += "</td>"; return c } function DelGroup(a) { DFBGFlie.Flie.FlieOperation.AjaxHtml("/UserGroup/UserGroupDel", { Id: a }, function (b) { if (b == "Suc") { parent.$("#popup_container").fadeOut(500); parent.$("#popup_overlay").fadeOut(500); parent.$("#popup_container").css("display", "none"); parent.$("#popup_overlay").css("display", "none"); parent.$("#popup_container").html(""); window.location.reload() } }, false) } function RoleShow(a) { DFBGFlie.Flie.FlieOperation.AjaxHtml("/Role/RoleShow", { UserId: a }, function (b) { if (b != "") { parent.$("#popup_container").html(b); $.dingwei("popup_container", "popup_overlay", "parent") } }, true) } function Add() { var a = $("#GroupName").val(); if (a == "") { alert("用户组名称不能为空"); return false } return true } function delGroupUser(b) { UserCodes2 = $("#UserHid").val(); var a = $(b).parent().attr("id").replace("UserSe", "") + "|" + $(b).parent().text().trim(); if (UserCodes2.indexOf(a) > -1) { if (UserCodes2.indexOf(a) == 0 && UserCodes2.indexOf(",") > 0) { $("#UserHid").val(UserCodes2.replace(a + ",", "")) } if (UserCodes2.indexOf(",") == 0 && UserCodes2.indexOf(a) != 0) { $("#UserHid").val(UserCodes2.replace("," + a + ",", "")) } if (UserCodes2.indexOf(",") > 0 && UserCodes2.indexOf(a) > 0) { $("#UserHid").val(UserCodes2.replace("," + a, "")) } if (UserCodes2.indexOf(",") < 0 && UserCodes2.indexOf(a) == 0) { $("#UserHid").val(UserCodes2.replace(a, "")) } } $(b).parent().remove() } function AddUserLaryer() { var a = ""; a += '<div style="overflow: hidden; height: 400px; width: 700px; border: 1px solid #b4cdec;border-radius:5px;">'; a += "<span class=\"icon-fullscreen1\" onclick=\"$.closezhezhao('popup_container','popup_overlay')\"></span>"; a += '<div class="widgettitle">'; a += "人员选择"; a += "</div>"; a += '<div style="background-color:#fff">'; a += '<div style="height: 22px; line-height: 22px; padding:5px 0px 5px 20px; border-bottom: 1px solid #b4cdec">'; a += '<span class="db-inline">处室/教研组</span>'; a += ' <select class="db-inline" id="AgencyList" style="border: 1px solid #b4cdec;margin-left:10px; height:22px; line-height:20px;">'; a += '<option value="">--请选择--</option>'; a += "</select>"; a += '<span class="db-inline" style=" margin-left: 10px;">教师姓名</span>'; a += '<input class="db-inline" type="text" style=" margin-left:10px; border: 1px solid #b4cdec" placeholder="输入教师姓名" id="UserName">'; a += '<div class="btn db-inline" onclick="GetUser()" style=" width:50px; height:13px;line-height:13px;">查询</div>'; a += "</div>"; a += '<div id="UserList" style="height:315px; overflow-y:auto;padding:5px">'; a += "</div>"; a += "</div>"; a += "</div>"; $("#popup_container").append(a); GetUser(); DFBGFlie.Flie.FlieOperation.AjaxList("/Role/GetAgencyCodeNameList", {}, function (d) { var c = d.AgencyList; var e = $("#AgencyList"); for (var b = 0; b < c.length; b++) { e.append('  <option value="' + c[b].AgencyCode + '">' + c[b].RootName + "-" + c[b].AgencyName + "</option>") } }, true); $.dingwei("popup_container", "popup_overlay") } function GetUser() { var c = $("#AgencyList").val(); var d = $("#UserName").val(); var a = $("#UserList"); var b = $("#UserHid").val(); a.children().remove(); DFBGFlie.Flie.FlieOperation.AjaxList("/UserGroup/GetUserlist", { AgencyName: c, UserName: d }, function (g) { var e = g.model; a.append('<div Id="All" class="btn userGroup" onclick="AddAllUser()">全选<span onclick="AddAllUser()"><img src="/Content/Img/UserAdd.png" /></span></div>'); for (var f = 0; f < e.length; f++) { if (b.indexOf(e[f].StaffCode) > -1) { a.append('<div Id="User' + e[f].StaffCode + '" class="btn userGroup" onclick="AddUser(\'' + e[f].StaffCode + "','" + e[f].StaffName + "')\">" + e[f].StaffName + "<span onclick=\"AddUser('" + e[f].StaffCode + "','" + e[f].StaffName + '\')"><img src="/Content/Img/Usercha.png" /></span></div>') } else { a.append('<div Id="User' + e[f].StaffCode + '" class="btn userGroup" onclick="AddUser(\'' + e[f].StaffCode + "','" + e[f].StaffName + "')\">" + e[f].StaffName + "<span  onclick=\"AddUser('" + e[f].StaffCode + "','" + e[f].StaffName + '\')"><img src="/Content/Img/UserAdd.png" /></span></div>') } } }, true) } function AddUser(a, d) { var c = $("#UserHid").val(); var b = a + "|" + d; if (c.indexOf(b) > -1) { if (c.indexOf(b) == 0 && c.indexOf(",") > 0) { $("#UserHid").val(c.replace(b + ",", "")) } if (c.indexOf(",") == 0 && c.Value(b) != 0) { $("#UserHid").val(c.replace("," + a + ",", "")) } if (c.indexOf(",") > 0 && c.indexOf(b) > 0) { $("#UserHid").val(c.replace("," + b, "")) } if (c.indexOf(",") < 0 && c.indexOf(b) == 0) { $("#UserHid").val(c.replace(b, "")) } $("#UserSe" + a).remove(); $("#User" + a).children().children("img").attr("src", "/Content/Img/UserAdd.png") } else { $("#UserHid").val(c + b + ","); $(".UserSelect").append('<div class="btn userGroup2" id="UserSe' + a + '">' + d + '<span onclick="delGroupUser(this)"><img src="/Content/Img/Usercha.png" /></span></div>'); $("#User" + a).children().children("img").attr("src", "/Content/Img/Usercha.png") } } function AddAllUser() { var e = $("#UserHid").val(); var c = $(".userGroup"); var g = $("#All"); if (g.hasClass("Ture")) { for (var d = 1; d < c.length; d++) { var a = $(c[d]).attr("id").replace("User", ""); var f = $(c[d]).text(); var b = a + "|" + f; UserCodes2 = $("#UserHid").val(); if (UserCodes2.indexOf(a) > -1) { if (UserCodes2.indexOf(b) == 0 && UserCodes2.indexOf(",") > 0) { $("#UserHid").val(UserCodes2.replace(b + ",", "")) } if (UserCodes2.indexOf(",") == 0 && UserCodes2.indexOf(b) != 0) { $("#UserHid").val(UserCodes2.replace("," + b + ",", "")) } if (UserCodes2.indexOf(",") > 0 && UserCodes2.indexOf(b) > 0) { $("#UserHid").val(UserCodes2.replace("," + b, "")) } if (UserCodes2.indexOf(",") < 0 && UserCodes2.indexOf(b) == 0) { $("#UserHid").val(UserCodes2.replace(b, "")) } } $("#UserSe" + a).remove(); $("#User" + a).children().children("img").attr("src", "/Content/Img/UserAdd.png") } $("#All").children().children("img").attr("src", "/Content/Img/UserAdd.png"); g.removeClass("Ture") } else { for (var d = 1; d < c.length; d++) { var a = $(c[d]).attr("id").replace("User", ""); var f = $(c[d]).text(); var b = a + "|" + f; if (!($("#UserHid").val().indexOf(a) > -1)) { if ($("#UserHid").val() == "" || $("#UserHid").val() == null) { $("#UserHid").val(b + ",") } else { $("#UserHid").val($("#UserHid").val() + b + ",") } $(".UserSelect").append('<div class="btn userGroup2" id="UserSe' + a + '">' + $(c[d]).text() + '<span onclick="delGroupUser(this)"><img src="/Content/Img/Usercha.png" /></span></div>'); $("#User" + a).children().children("img").attr("src", "/Content/Img/Usercha.png") } } $("#All").children().children("img").attr("src", "/Content/Img/Usercha.png"); g.addClass("Ture") } } function Apply(a, b) { var c = $("#userName").val(); DFBGFlie.Flie.FlieOperation.AjaxHtml("/UserGroup/UserGroupExamine", { GroupId: a, UserId: b, UserName: c }, function (d) { if (d == "Suc") { parent.$("#popup_container").fadeOut(500); parent.$("#popup_overlay").fadeOut(500); parent.$("#popup_container").css("display", "none"); parent.$("#popup_overlay").css("display", "none"); parent.$("#popup_container").html(""); window.location.reload() } }, false) } function Quit(a, b) { var c = $("#userName").val(); DFBGFlie.Flie.FlieOperation.AjaxHtml("/UserGroup/UserGroupQuit", { GroupId: a, UserId: b, UserName: c }, function (d) { if (d == "Suc") { parent.$("#popup_container").fadeOut(500); parent.$("#popup_overlay").fadeOut(500); parent.$("#popup_container").css("display", "none"); parent.$("#popup_overlay").css("display", "none"); parent.$("#popup_container").html(""); window.location.reload() } }, false) };