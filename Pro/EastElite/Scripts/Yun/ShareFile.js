var DFBGShare = { FlieShare: {} }; var OptionFile = (function (b) { var d = { length: 0 }; var d = $.extend(d, b), c = $("body"), a = '<div id="select"></div>'; return { actionLock: false, releaseTarget: false, keyCode: null, optionDown: function (i, h, f) { this.releaseTarget = false; this.getImgList(i); var g = f.pageX; var e = f.pageY; $("#select").css({ top: e + 1, left: g + 1 }) }, optionMoving: function (g, f, e) { if (this.actionLock) { this.optionDown(g, f, e) } }, getImgList: function (f) { if (f > 10) { f = parseInt(f / 10) } if (f > 100) { f = parseInt(f / 100) } if (!this.actionLock) { c.append(a); var e = "<em>" + f + "</em>"; $("#select").html(e) } this.actionLock = true }, closeOption: function (e) { var f = this; $(document).keydown(function (g) { f.keyCode = g.keyCode; $(document).on("mouseup", function (h) { if (!f.releaseTarget) { $(".moving-box").remove(); f.actionLock = false; $(document).unbind("mousemove"); f.releaseTarget = true; e(h, f.keyCode); $(document).unbind("keydown"); f.keyCode = null } }) }); $(document).trigger("keydown"); $(document).keyup(function (g) { $(document).unbind("keyup"); $(document).unbind("keydown"); f.keyCode = null }) } } }); DFBGShare.FlieShare.Flie = { MyFileLoad: function (d, a) { var c = DFBGFlie.Flie.FlieOperation; var b = DFBGShare.FlieShare.Flie; c.AjaxList("/SchoolShare/FileLoad", { FileId: d, SearchName: a }, function (n, h) { var j = n.model; if (h == "success") { var m = ""; var f = ""; if (j.length != 0) { $("#SumNum").html("已全部加载，共" + j.length + "个"); for (var k = 0; k < j.length; k++) { var l = j[k]; m += '<li id="add' + l.FileId + '" href="javascript:;" class="grid-view-item open-enable" style="display: block;">'; m += ' <div class="FileShow"  title="' + l.FileName + '">'; if (l.IsFolder == true) { m += " <div onclick=\"DFBGShare.FlieShare.Flie.FileClick('" + l.FileId + "','" + l.FileName + "')\">" } else { m += " <div onclick=\"DFBGFlie.Flie.FlieOperation.FileShowControl('" + l.FileExtName + "','" + l.FileId + "')\">" } if (l.IsFolder == true) { m += '<span  class="fileicon dir-large">' } else { switch (l.FileExtName) { case ".jpg": case ".png": case ".jpeg": case ".gif": case ".bmp": m += '<span  class="fileicon fileicon-large-pic fileicon-all">'; m += '<img class="thumb db-none" style="width:100px;height:100px;" data-url="/File/ImgSuoLue?FileId=' + l.FileId + '" src="">'; break; case ".docx": case ".doc": case ".dot": case ".docm": m += '<span  class="fileicon fileicon-large-doc">'; break; case ".xls": case ".xlsx": m += '<span  class="fileicon fileicon-large-xls">'; break; case ".txt": m += '<span  class="fileicon fileicon-large-txt">'; break; case ".rar": case ".7z": m += '<span  class="fileicon fileicon-large-rar">'; break; case ".zip": m += '<span  class="fileicon fileicon-large-zip">'; break; case ".pdf": m += '<span  class="fileicon fileicon-large-pdf">'; break; case ".flv": case ".mp4": case ".mkv": case ".rmvb": case ".avi": case ".swf": case ".wmv": case ".3gp": case ".mpeg": case ".mpg": case ".rm": case ".asf": case ".mov": case ".smi": m += '<span  class="fileicon fileicon-large-video">'; break; case ".exe": m += '<span  class="fileicon fileicon-large-exe">'; break; case ".psd": m += '<span  class="fileicon fileicon-large-psd">'; break; case ".mp3": case ".wma": case ".wav": m += '<span  class="fileicon fileicon-large-mp3">'; break; case ".ppt": case ".pptx": case ".pptm": m += '<span  class="fileicon fileicon-large-ppt">'; break; case ".xmind": m += '<span  class="fileicon fileicon-large-xmind">'; break; default: m += '<span  class="fileicon fileicon-all">'; break } } m += "</span>"; m += "</div>"; m += "<label onmousedown=\"ClickSelCss('add" + l.FileId + '\')" class="checkbox"></label>'; m += "</div>"; if (l.FileName.length > 6) { m += '<div class="file-name"><span title="' + l.FileName + '" class="filename">' + l.FileName.substr(0, 6) + "...</span></div> " } else { m += '<div class="file-name"><span title="' + l.FileName + '" href="javascript:void(0);" class="filename">' + l.FileName + "</span></div>" } m += "</li>"; f += '<div class="g-clearfix list-view-item open-enable">'; if (l.IsFolder == true) { f += '<input type="checkbox" onclick="YzCheAll()" class="checkbox1" name="cheName" value="' + l.FileId + '" />'; f += '<div class="fileicon  dir-small"></div>' } else { f += '<input type="checkbox" onclick="YzCheAll()" class="checkbox1" name="cheName" value="' + l.FileId + '" />'; switch (l.FileExtName) { case ".jpg": case ".png": case ".jpeg": case ".jpg": case ".gif": case ".bmp": f += '<div  class="fileicon fileicon-small-pic"></div>'; break; case ".docx": case ".doc": case ".dot": case ".docm": f += '<div  class="fileicon fileicon-small-doc"></div>'; break; case ".xls": case ".xlsx": f += '<div  class="fileicon fileicon-small-xls"></div>'; break; case ".txt": f += '<div  class="fileicon fileicon-small-txt"></div>'; break; case ".rar": case ".7z": f += '<div  class="fileicon fileicon-small-rar"></div>'; break; case ".zip": f += '<div  class="fileicon fileicon-small-zip"></div>'; break; case ".pdf": f += '<div  class="fileicon fileicon-small-pdf"></div>'; break; case ".flv": case ".mp4": case ".mkv": case ".rmvb": case ".avi": case ".swf": case ".wmv": case ".3gp": case ".mpeg": case ".mpg": case ".rm": case ".asf": case ".mov": case ".smi": f += '<div  class="fileicon fileicon-small-video"></div>'; break; case ".psd": f += '<div  class="fileicon fileicon-small-psd"></div>'; break; case ".mp3": case ".wma": case ".wav": f += '<div  class="fileicon fileicon-small-mp3"></div>'; break; case ".ppt": case ".pptx": case ".pptm": f += '<div  class="fileicon fileicon-small-ppt"></div>'; break; case ".xmind": f += '<div  class="fileicon fileicon-small-xmind"></div>'; break; default: f += '<div  class="fileicon fileicon-small"></div>'; break } } f += '<div style="width: 50%" class="file-name">'; f += '<div class="text">'; if (l.IsFolder == true) { f += "<a onclick=\"DFBGShare.FlieShare.Flie.FileClick('" + l.FileId + "','" + l.FileName + '\')"  class="filename" href="#" title="' + l.FileName + '">' + l.FileName + "</a></div>" } else { f += "<a onclick=\"DFBGFlie.Flie.FlieOperation.FileShowControl('" + l.FileExtName + "','" + l.FileId + '\')" class="filename" href="#" title="' + l.FileName + '">' + l.FileName + "</a></div>" } f += '<div class="operate">'; f += '<div style="position: absolute; top: 0px; padding-top: 0px; line-height: normal;">'; if (l.IsFolder != true) { f += '<a href="/File/DownFile?FileId=' + l.FileId + '" class="g-button" style=""><span class="g-button-right"><em title="下载" class="icon icon-download-blue"></em></span></a>' } else { } f += "    </div>"; f += "</div>"; f += "</div>"; f += '<div style="width: 16%" class="file-size">' + DFBGFlie.Flie.FlieOperation.GetFileSize(l.FileSizeKb) + "</div>"; var g = new Date(parseInt(l.FileCreateTime.replace("/Date(", "").replace(")/", ""), 10)); f += '<div style="width: 10%" class="ctime">已分享</div>'; f += '<div style="width: 10%" class="ctime">' + l.CreateName + "</div>"; f += '<div style="width: 13%" class="ctime">' + g.Format("yyyy-MM-dd hh:mm") + "</div>"; f += "</div>"; f += "</div>" } } else { f += '<div class="aGMvFtb">'; f += '<div class="hqvyGW05 wegnv3JM">'; f += '<p class="ggEQwFb">'; f += " 还没分享文件哦"; f += "</p>"; f += "</div>"; f += "</div>"; m = f } $("#FileShowList").html(f); $("#FileShow").html(m); $(".module-list-view .list-view-item").hover(function () { $(this).children(".file-name").children(".operate").toggle() }); if ($(".list-view-item").length > 3) { $(".list-view-item:last .operate .menu").css({ "left": "-40px", "top": "-50px" }) } var e = new OptionFile(); $(".module-grid-view .grid-view li").on("mousedown", function (p) { p.preventDefault(); p.stopPropagation(); var o = $(".item-active").length; var i = setTimeout(function () { e.optionDown(o, 1, p); $(document).mousemove(function (q) { e.optionMoving(o, 1, q); e.closeOption(function (x, s) { var w = x.target.className; $("#select").remove(); if (w == "filename" || w == "fileicon dir-large" || w == "grid-view-item open-enable") { var v = ""; var r = ""; var u = getCookie("ShowType"); if (u == "grid") { var y = $(".item-active"); for (var t = 0; t < y.length; t++) { v += y[t].id + "," } } switch (w) { case "filename": r = $(x.target).parent().parent().attr("id").replace("add", ""); break; case "fileicon dir-large": r = $(x.target).parent().parent().parent().attr("id").replace("add", ""); break; case "grid-view-item open-enable": r = $(x.target).attr("id").replace("add", ""); break; default: break } if (r != "") { b.TuoMoVe(v, r) } } }) }) }, 200); $(document).mouseup(function () { clearTimeout(i) }) }); c.SetContainerHeight(); $("img").load(function () { $(this).hide(); $(this).stop().fadeIn("5000") }); $(".grid-view-item").scrollLoading() } }) }, InFileOnlode: function (a) { DFBGFlie.Flie.FlieOperation.AjaxHtml("/File/ShareFileALLNavigation", { parentFileId: a }, function (b) { if (b != "") { $("#TitleIds").append(b) } }, true) }, FileClick: function (a) { window.location.href = "/SchoolShare/School?FileId=" + a }, ShareFileMethod: function () { window.location.href = "/SchoolShare/School?FileId=" }, TuoMoVe: function (d, a) { var b = "../File/FileMove"; var c = { FileIdList: d, WhereId: a, MoveType: 2, Share: "1001" }; EDUCAjax(c, function () { $.closezhezhao("popup_container", "popup_overlay"); if ($(".module-tip").length == 0) { $("body").append('<div class="module-tip" style="top: 190px; left: 50%; margin-left: -77.5px;"></div>') } $(".module-tip").html('<div class="tip-inner"><i class="tip-icon tip-icon-loading"></i><span class="tip-msg">正在移动文件，请稍候…</span></div></span></div>'); $(".module-tip").css("display", "block") }, function (e) { if (e == "suc") { if ($(".module-tip").length == 0) { $("body").append('<div class="module-tip" style="top: 190px; left: 50%; margin-left: -48.5px"></div>') } else { $(".module-tip").css("margin-left", "-48.5px") } $(".module-tip").html('<div class="tip-inner"><i class="tip-icon tip-icon-success"></i><span class="tip-msg">文件移动成功</span></div>'); $(".module-tip").css("display", "block"); window.location.reload(); setTimeout('$(".module-tip").hide()', 5000) } else { if ($(".module-tip").length == 0) { $("body").append('<div class="module-tip" style="top: 190px; left: 50%; margin-left: -48.5px"></div>') } else { $(".module-tip").css("margin-left", "-48.5px") } $(".module-tip").html('<div class="tip-inner"><i class="tip-icon tip-icon-success"></i><span class="tip-msg">文件移动失败</span></div>'); $(".module-tip").css("display", "block"); window.location.reload(); setTimeout('$(".module-tip").hide()', 5000) } }, b, "html", false, "", false) } };