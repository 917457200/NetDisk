var DFBG = { FlieOAImg: {} }; var src = ""; var rotateindex = 0; DFBG.FlieOAImg.FlieImg = { dirName: function (b) { var a = DFBGFlie.Flie.FlieOperation; if (b != "") { parent.window[0].window.location.href = "/MyFile/MyFile?FileId=" + b } a.ImgShow() }, ImgDownLoad: function () { var a = $("#viewpic-image").attr("fileid"); DFBGFlie.Flie.FlieOperation.DownLoad(a) }, ImgShareMethod: function () { var a = $("#viewpic-image").attr("fileid"); DFBGFlie.Flie.FlieOperation.ShareTransfer(a, "img") }, Transfer: function (a) { var b = $("#viewpic-image").attr("fileid"); DFBGFlie.Flie.FlieOperation.Transfer(b, a) }, Onload: function () { var a = $(window).width(); if (a < 1024) { a = 1024 } var b = 0; if (!$(".retract").hasClass("retract-icon-hide")) { b = 253 } $(".dlg-bd").css({ "width": a - b + "px", "height": $(window).height() + "px" }); $(".module-thumbnailPic").css("width", a - b + "px"); $(".module-showPic").css({ "width": a - (b + 120) + "px", "height": $(window).height() + "px" }); $(".module-thumbnailPic").children().css("width", a - b + "px"); var d = $("#viewpic-image"); var c = DFBG.FlieOAImg.FlieImg; c.imageSizeReload(b, d) }, imageSizeReload: function (b, d) { var j = DFBG.FlieOAImg.FlieImg; var c = j.ImageAttribute(d); var i = 0, f = 0; if (src == "") { var a = d.attr("fileid"); src = "/File/ImgLow?FileId=" + a + "&W=" + c.windowWidth + "&H=" + c.windowHeight; d.attr("src", src) } if (c.YuanWidth <= c.windowWidth && c.YmageHeight <= c.windowHeight) { d.css("height", c.YmageHeight + "px"); d.css("width", c.YuanWidth + "px"); i = (c.windowWidth - c.YuanWidth) / 2; f = (c.windowHeight - c.YmageHeight) / 2; d.css({ "top": f + "px", "left": i + "px" }); return } var e = c.windowWidth; var g = e * c.YmageHeight / c.YuanWidth; if (g > c.windowHeight) { g = c.windowHeight; e = g * c.YuanWidth / c.YmageHeight; if (e > c.windowWidth) { e = c.windowWidth } } d.css("height", g + "px"); d.css("width", e + "px"); i = (c.windowWidth - e) / 2; f = (c.windowHeight - g) / 2; d.css({ "top": f + "px", "left": i + "px" }) }, XuanZhuan: function (g) { var f = $("#viewpic-image"); var d = DFBG.FlieOAImg.FlieImg; var b = d.ImageAttribute(f); var a = 0, c; if (g == "left") { rotateindex++ } else { rotateindex-- } f.addClass("transform"); var e = rotateindex * 90 + "deg"; f.css({ "transform": "rotate(" + e + ")", "transform-origin": "50% 50%" }); if (b.YuanWidth <= b.windowWidth && b.YmageHeight <= b.windowHeight) { a = (b.windowWidth - b.imageWidth) / 2; c = (b.windowHeight - b.imageHeight) / 2; f.css({ "top": c + "px", "left": a + "px" }); return } if (rotateindex % 2 != 0) { f.css("height", b.imageHeight * b.YmageHeight / b.YuanWidth + "px"); f.css("width", b.imageHeight + "px"); a = (b.windowWidth - b.imageHeight) / 2; c = (b.windowHeight - b.imageHeight * b.YmageHeight / b.YuanWidth) / 2 } else { f.css("height", b.imageWidth + "px"); f.css("width", b.imageWidth * b.YuanWidth / b.YmageHeight + "px"); a = (b.windowWidth - b.imageWidth * b.YuanWidth / b.YmageHeight) / 2; c = (b.windowHeight - b.imageWidth) / 2 } f.css({ "top": c + "px", "left": a + "px" }) }, ImageAttribute: function (b) { var a = { imageWidth: b.width(), imageHeight: b.height(), YuanWidth: b.attr("width"), YmageHeight: b.attr("height"), windowWidth: $(".module-showPic").width(), windowHeight: $(".module-showPic").height() }; return a }, PreArrow: function (d, c, b) { var a = DFBG.FlieOAImg.FlieImg; DFBGFlie.Flie.FlieOperation.AjaxHtml("/Details/ImgNext", { FileId: d, Arrow: c, ParentFileId: b }, function (e) { var h = $.Browser(); if (e.FileInfo != null) { var f = $("#viewpic-image"); f.hide(); if (h == "IE") { $(".loading-gif").show() } else { $(".loading-container").show() } src = "/File/ImgLow?FileId=" + e.FileInfo.FileId + "&W=" + $(".module-showPic").width() + "&H=" + $(".module-showPic").height(); f.attr({ "src": src, "fileid": e.FileInfo.FileId, "width": e.Width, "height": e.Height }); $(".large-pic a").attr("href", src); f.load(function () { a.Onload(); $(this).show(); $(".loading-container").hide(); $(".loading-gif").hide() }) } else { var g = ""; if (c == "left") { g = "已经是第一张图片啦" } else { g = "已经是最后一张图片啦" } if ($(".module-tip").length == 0) { $(".module").append('<div class="module-tip" style="top: 65px; left: 50%; margin-left: -66.5px;"></div>') } $(".module-tip").html('<div class="tip-inner"><i class="tip-icon tip-icon-caution"></i><span class="tip-msg">' + g + "</span></div>"); $(".module-tip").show(); setTimeout('$(".module-tip").hide()', 2000) } }, false, "json") } };